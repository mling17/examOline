{% extends 'base.html' %}

{% block content %}
    <form class="form-horizontal" method="post" novalidate>
        {% csrf_token %}
        {% for field in form %}
            <div class="form-group">
                {% if field.label != 'hide' %}
                    <label class="col-sm-2 control-label">{{ field.label }}</label>
                {% endif %}

                <div class="col-sm-8">
                    {{ field }}
                    <span style="color: red;">{{ field.errors.0 }}</span>

                </div>
            </div>
        {% endfor %}
        <div class="hide" id="q_type_1">
            <div class="form-group">
                <label class="col-sm-2 control-label">A、</label>
                <div class="col-sm-8">
                    <input type="text" name="choice_a" class=" form-control" placeholder="请输入选项" required=""
                           id="id_choice_a">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">B、</label>
                <div class="col-sm-8">
                    <input type="text" name="choice_b" class=" form-control" placeholder="请输入选项" required=""
                           id="id_choice_b">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">C、</label>
                <div class="col-sm-8">
                    <input type="text" name="choice_c" class=" form-control" placeholder="请输入选项" required=""
                           id="id_choice_c">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">D、</label>
                <div class="col-sm-8">
                    <input type="text" name="choice_d" class=" form-control" placeholder="请输入选项" required="required"
                           id="id_choice_d">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">答案</label>
                <div class="col-sm-8">
                    <label class="radio-inline">
                        <input type="radio" name="choice_check" id="choice_check_1" value="A"> A
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="choice_check" id="choice_check_2" value="B"> B
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="choice_check" id="choice_check_3" value="C"> C
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="choice_check" id="choice_check_4" value="D"> D
                    </label>
                </div>
            </div>
        </div>

        <div class="hide" id="q_type_2">
            <div class="form-group">
                <label class="col-sm-2 control-label">A、</label>
                <div class="col-sm-8">
                    <input type="text" name="mult_choice_a" class=" form-control" placeholder="请输入选项" required=""
                           id="mult_choice_a">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">B、</label>
                <div class="col-sm-8">
                    <input type="text" name="mult_choice_b" class=" form-control" placeholder="请输入选项" required=""
                           id="mult_choice_b">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">C、</label>
                <div class="col-sm-8">
                    <input type="text" name="mult_choice_c" class=" form-control" placeholder="请输入选项" required=""
                           id="mult_choice_c">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">D、</label>
                <div class="col-sm-8">
                    <input type="text" name="mult_choice_d" class=" form-control" placeholder="请输入选项" required=""
                           id="mult_choice_d">
                    <span style="color: red;"></span>

                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">答案</label>
                <div class="col-sm-8">
                    <label class="checkbox-inline">
                        <input type="checkbox" name="mult_choice_check" id="mult_choice_check_1" value="A"> A
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="mult_choice_check" id="mult_choice_check_2" value="B"> B
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="mult_choice_check" id="mult_choice_check_3" value="C"> C
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" name="mult_choice_check" id="mult_choice_check_4" value="D"> D
                    </label>
                </div>
            </div>
        </div>

        <div class="hide" id="q_type_3">
            <div class="form-group">
                <label class="col-sm-2 control-label">答案</label>
                <div class="col-sm-8">
                    <label class="radio-inline">
                        <input type="radio" name="judge_check" id="judge_check_1" value="A"> 正确
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="judge_check" id="judge_check_2" value="B"> 错误
                    </label>
                </div>
            </div>
        </div>
        <div class="hide" id="q_type_4">
            <div class="form-group">
                <label class="col-sm-2 control-label">答案</label>
                <div class="col-sm-8">
                    <input type="text" name="fill_answer" class=" form-control" placeholder="请输入正确答案" required=""
                           id="id_fill">
                    <span style="color: red;"></span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-10 control-label">【注】<span>一个"/"符号填写一个答案，如果答案有多种表达方式，例如：二和2，中间用#隔开； 填空题答案中，暂不支持公式和图片（无法判断）</span>
                </label>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-8">
                <input type="submit" value="保 存" class="btn btn-primary">
            </div>
        </div>
    </form>

{% endblock %}

{% block js %}
    <script>
        init();

        function init() {
            var q_type = $('#id_type');
            var select_value = q_type.val();
            for (i = 1; i < 5; i++) {
                var q_type_id = '#q_type_' + i.toString()
                if (i == select_value) {
                    $(q_type_id).removeClass('hide').addClass('show')
                } else {
                    $(q_type_id).removeClass('show').addClass('hide')
                }
            }
            get_question_options(select_value);
        }

        function get_question_options(select_value) {
            var url = "{% url 'question_bank:get_question_options'  %}" + '?q_id=' +{{ q_id }};
            console.log(url)
            $.ajax({
                type: 'get',
                async: true,
                dataType: 'json',
                url: url,
                success: function (res) {
                    if (res.status == 'success') {
                        console.log(res.data)
                        for (i = 0; i < res.data.length; i++) {
                            var title = res.data[i].title.toLowerCase();
                            var content = res.data[i].content;
                            var is_answer = res.data[i].is_answer;
                            console.log(title, content, is_answer)
                            if (select_value == '1') {
                                var choice_id = '#id_choice_' + title
                                var choice_answer_id = '#choice_check_' + (i + 1).toString()
                                $(choice_id).val(content)
                                if (is_answer) {
                                    $(choice_answer_id).prop('checked', true);
                                }
                            } else if (select_value == '2') {
                                var mutl_content_id = '#mult_choice_' + title
                                var mutl_answer_id = '#mult_choice_check_' + (i + 1).toString()
                                $(mutl_content_id).val(content)
                                if (is_answer) {
                                    $(mutl_answer_id).prop('checked', true);
                                }
                            } else if (select_value == '3') {
                                var judge_check_id = '#judge_check_' + (i + 1).toString()
                                if (is_answer) {
                                    $(judge_check_id).prop('checked', true);
                                }
                            } else if (select_value == '4') {
                                console.log(4)
                            } else {
                                console.log('oooooooo');
                            }
                        }
                    } else {
                        alert(res.msg)
                    }

                },
                error: function () {

                }
            })
        }
    </script>
    <script>
        var q_type = $('#id_type');
        {#console.log(q_type)#}
        q_type.change(function () {
            var select_value = q_type.val()
            for (i = 1; i < 5; i++) {
                var q_type_id = '#q_type_' + i.toString()
                if (i == select_value) {
                    $(q_type_id).removeClass('hide').addClass('show')
                } else {
                    $(q_type_id).removeClass('show').addClass('hide')
                }
            }
        })
    </script>
{% endblock %}